// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String        @id @default(uuid())
  githubId      String        @unique
  email         String?
  name          String?
  avatarUrl     String?
  accessToken   String?       // GitHub access token
  projects      Project[]
  subscription  Subscription?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
}

model Project {
  id          String      @id @default(uuid())
  userId      String
  user        User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  repoName    String      // e.g., "commit-log"
  repoOwner   String      // e.g., "username"
  repoFullName String     // e.g., "username/commit-log"
  apiKey      String      @unique @default(cuid())
  themeColor  String      @default("#0ea5e9")
  position    String      @default("bottom-right") // bottom-left or bottom-right
  lastSyncAt  DateTime?
  changelogs  Changelog[]
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  @@unique([userId, repoFullName])
}

model Changelog {
  id          String   @id @default(uuid())
  projectId   String
  project     Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  title       String
  description String?  @db.Text
  type        String   // FEAT, FIX, IMPROVEMENT
  status      String   @default("DRAFT") // DRAFT, PUBLISHED
  commitHash  String?  @unique
  authorName  String?
  authorAvatar String?
  publishedAt DateTime?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([projectId, status])
}

model Subscription {
  id        String   @id @default(uuid())
  userId    String   @unique
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  tier      String   @default("FREE") // FREE, PRO
  status    String   @default("ACTIVE") // ACTIVE, CANCELLED
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
